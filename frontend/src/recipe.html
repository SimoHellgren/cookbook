<!DOCTYPE html>
<html>
  <head>
    <title>Cookbook</title>
    <link rel="stylesheet" href="index.css">
  </head>
  <body>
    <h1 id="recipe-name"></h1>
    <section id="ingredients">
      <h2>Ingredients</h2>
      <ul></ul>
    </section>

    <section id="method">
      <h2>Method</h2>
      <ul></ul>
    </section>

    <script>
      let recipe = {}
      let ingredients = []

      let $ingredients = document.getElementById("ingredients")
      let $method = document.getElementById("method")

      const getRecipe = () => {
        let params = new URLSearchParams(window.location.search)
        let id = params.get("recipe")

        
        let recipePromise = fetch(`http://localhost:8000/recipes/${id}`)
          .then(r => r.json())
          .then(data => recipe = data)

        let ingredientsPromise = fetch(`http://localhost:8000/recipes/${id}/ingredients`)
          .then(r => r.json())
          .then(data => ingredients = data)

        return Promise.all([recipePromise, ingredientsPromise])
      }


      const renderIngredients = () => {
        let ul = $ingredients.querySelector("ul")

        ingredients.forEach(i => {
          let li = document.createElement("li")
          let text = `${i.ingredient.name} ${i.quantity}${i.measure}`
          li.textContent = i.optional ? `(${text})` : text
          ul.appendChild(li)
        })

      }

      const renderMethod = () => {
        let ul = $method.querySelector("ul")
        recipe.method.split("\n").forEach(line => {
          let li = document.createElement("li")
          li.textContent = line
          ul.appendChild(li)
        })
      }

      const renderPage = () => {
        document.title = `${recipe.name} - Cookbook` 
        document.getElementById("recipe-name").textContent = recipe.name
        renderIngredients()
        renderMethod()
      }

      getRecipe()
        .then(renderPage)
    </script>

  </body>
</html>